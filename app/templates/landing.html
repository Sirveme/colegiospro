<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#0a1628">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="ColegiosPro â€” Sistema integral de gestiÃ³n para Colegios Profesionales del PerÃº. FacturaciÃ³n electrÃ³nica, cobranzas, comunicaciones.">
<link rel="manifest" href="/static/manifest.json">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›ï¸</text></svg>">
<title>ColegiosPro â€” GestiÃ³n Integral para Colegios Profesionales</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg-deep: #060d1b;
  --bg-primary: #0a1628;
  --bg-card: #111d33;
  --bg-card-hover: #162440;
  --bg-glass: rgba(17, 29, 51, 0.85);
  --text-primary: #f0f4fc;
  --text-secondary: #8b9cc0;
  --text-muted: #5a6d94;
  --accent-blue: #3b82f6;
  --accent-blue-light: #60a5fa;
  --accent-gold: #f59e0b;
  --accent-gold-light: #fbbf24;
  --accent-emerald: #10b981;
  --accent-rose: #f43f5e;
  --gradient-hero: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #f59e0b 100%);
  --gradient-gold: linear-gradient(135deg, #f59e0b, #f97316);
  --gradient-blue: linear-gradient(135deg, #3b82f6, #6366f1);
  --gradient-emerald: linear-gradient(135deg, #10b981, #14b8a6);
  --shadow-glow: 0 0 40px rgba(59,130,246,0.15);
  --shadow-card: 0 4px 24px rgba(0,0,0,0.3);
  --radius: 16px;
  --radius-sm: 10px;
  --font-display: 'Outfit', sans-serif;
  --font-body: 'DM Sans', sans-serif;
  --nav-h: 64px;
  --cta-bar-h: 88px;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; scroll-padding-top: var(--nav-h); }
body {
  font-family: var(--font-body);
  background: var(--bg-deep);
  color: var(--text-primary);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  padding-bottom: var(--cta-bar-h);
}
a { color: inherit; text-decoration: none; }
img, video { max-width: 100%; display: block; }
button { font-family: var(--font-body); cursor: pointer; border: none; }

/* â•â•â• ANIMATIONS â•â•â• */
@keyframes fadeUp { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:translateY(0); } }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
@keyframes float { 0%,100% { transform:translateY(0); } 50% { transform:translateY(-12px); } }
@keyframes pulse-ring { 0% { transform:scale(0.9); opacity:0.6; } 50% { transform:scale(1.1); opacity:0.2; } 100% { transform:scale(0.9); opacity:0.6; } }
@keyframes gradient-shift { 0% { background-position:0% 50%; } 50% { background-position:100% 50%; } 100% { background-position:0% 50%; } }
@keyframes shimmer { 0% { transform:translateX(-100%); } 100% { transform:translateX(200%); } }
@keyframes bounceIn { 0% { opacity:0; transform:scale(0.3); } 50% { transform:scale(1.05); } 70% { transform:scale(0.95); } 100% { opacity:1; transform:scale(1); } }
@keyframes slideUp { from { opacity:0; transform:translateY(100%); } to { opacity:1; transform:translateY(0); } }
@keyframes msgAppear { 0% { opacity:0; transform:translateY(16px) scale(0.95); } 100% { opacity:1; transform:translateY(0) scale(1); } }
@keyframes typing { 0% { opacity:0.3; } 50% { opacity:1; } 100% { opacity:0.3; } }
@keyframes glow-pulse { 0%,100% { box-shadow:0 0 20px rgba(245,158,11,0.3); } 50% { box-shadow:0 0 40px rgba(245,158,11,0.6), 0 0 80px rgba(245,158,11,0.2); } }
@keyframes nudge { 0%,100% { transform:translateX(0); } 25% { transform:translateX(-4px); } 75% { transform:translateX(4px); } }
.reveal { opacity:0; transform:translateY(30px); transition: all 0.7s cubic-bezier(0.16,1,0.3,1); }
.reveal.visible { opacity:1; transform:translateY(0); }
.reveal-delay-1 { transition-delay:0.1s; } .reveal-delay-2 { transition-delay:0.2s; }
.reveal-delay-3 { transition-delay:0.3s; } .reveal-delay-4 { transition-delay:0.4s; }

/* Noise overlay */
body::before {
  content:''; position:fixed; inset:0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none; z-index:9999; opacity:0.5;
}

/* â•â•â• NAVBAR â•â•â• */
.nav {
  position:fixed; top:0; left:0; right:0; z-index:100;
  height:var(--nav-h); display:flex; align-items:center; justify-content:space-between;
  padding:0 clamp(16px,4vw,48px);
  background:rgba(6,13,27,0.85); backdrop-filter:blur(20px) saturate(1.5);
  border-bottom:1px solid rgba(255,255,255,0.05); transition:all 0.3s;
}
.nav.scrolled { background:rgba(6,13,27,0.95); box-shadow:0 2px 20px rgba(0,0,0,0.3); }
.nav-logo { display:flex; align-items:center; gap:10px; font-family:var(--font-display); font-weight:800; font-size:1.3rem; letter-spacing:-0.02em; }
.nav-logo span { background:var(--gradient-hero); background-size:200% 200%; animation:gradient-shift 4s ease infinite; -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.nav-links { display:flex; gap:32px; align-items:center; }
.nav-links a { font-size:0.88rem; font-weight:500; color:var(--text-secondary); transition:color 0.2s; position:relative; }
.nav-links a:hover { color:var(--text-primary); }
.nav-links a::after { content:''; position:absolute; bottom:-4px; left:0; width:0; height:2px; background:var(--accent-blue); border-radius:2px; transition:width 0.3s; }
.nav-links a:hover::after { width:100%; }
.nav-hamburger { display:none; background:none; color:var(--text-primary); font-size:1.5rem; }

/* â•â•â• HERO â•â•â• */
.hero {
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  padding:calc(var(--nav-h) + 40px) clamp(16px,5vw,80px) 60px;
  position:relative; overflow:hidden;
}
.hero-bg { position:absolute; inset:0; z-index:0; }
.hero-bg::before { content:''; position:absolute; top:-20%; right:-10%; width:700px; height:700px; background:radial-gradient(circle, rgba(59,130,246,0.12) 0%, transparent 70%); animation:float 8s ease-in-out infinite; }
.hero-bg::after { content:''; position:absolute; bottom:-10%; left:-5%; width:500px; height:500px; background:radial-gradient(circle, rgba(245,158,11,0.08) 0%, transparent 70%); animation:float 10s ease-in-out infinite 2s; }
.hero-grid { position:absolute; inset:0; background-image: linear-gradient(rgba(59,130,246,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(59,130,246,0.03) 1px, transparent 1px); background-size:60px 60px; mask-image:radial-gradient(ellipse 60% 60% at 50% 50%, black, transparent); }
.hero-content { position:relative; z-index:1; max-width:1100px; width:100%; display:flex; flex-direction:column; align-items:center; text-align:center; }
.hero-badge { display:inline-flex; align-items:center; gap:8px; padding:6px 16px 6px 8px; background:var(--bg-card); border:1px solid rgba(59,130,246,0.2); border-radius:100px; font-size:0.82rem; color:var(--accent-blue-light); margin-bottom:28px; animation:fadeUp 0.6s ease both; }
.hero-badge .dot { width:8px; height:8px; border-radius:50%; background:var(--accent-emerald); box-shadow:0 0 8px var(--accent-emerald); animation:pulse-ring 2s infinite; }
.hero-h1 { font-family:var(--font-display); font-size:clamp(2.4rem,6vw,4.5rem); font-weight:900; line-height:1.05; letter-spacing:-0.03em; margin-bottom:24px; animation:fadeUp 0.6s ease both 0.15s; opacity:0; }
.hero-h1 .highlight { background:var(--gradient-hero); background-size:200% 200%; animation:gradient-shift 4s ease infinite; -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.hero-sub { font-size:clamp(1rem,2vw,1.25rem); color:var(--text-secondary); line-height:1.6; max-width:640px; margin-bottom:40px; animation:fadeUp 0.6s ease both 0.3s; opacity:0; }
.hero-actions { display:flex; gap:16px; flex-wrap:wrap; justify-content:center; animation:fadeUp 0.6s ease both 0.45s; opacity:0; }
.btn-primary { padding:14px 32px; border-radius:var(--radius-sm); background:var(--gradient-blue); color:#fff; font-weight:700; font-size:1rem; display:inline-flex; align-items:center; gap:8px; transition:transform 0.2s, box-shadow 0.2s; position:relative; overflow:hidden; }
.btn-primary::after { content:''; position:absolute; top:0; left:0; width:40%; height:100%; background:linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent); animation:shimmer 3s infinite 1s; }
.btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 30px rgba(59,130,246,0.3); }
.btn-secondary { padding:14px 32px; border-radius:var(--radius-sm); background:var(--bg-card); border:1px solid rgba(255,255,255,0.1); color:var(--text-primary); font-weight:600; font-size:1rem; display:inline-flex; align-items:center; gap:8px; transition:all 0.2s; }
.btn-secondary:hover { border-color:rgba(255,255,255,0.2); background:var(--bg-card-hover); }

/* Hero video */
.hero-video-wrap { margin-top:60px; width:100%; max-width:800px; animation:fadeUp 0.8s ease both 0.6s; opacity:0; }
.video-container { position:relative; border-radius:var(--radius); overflow:hidden; background:var(--bg-card); border:1px solid rgba(255,255,255,0.08); box-shadow:var(--shadow-glow), 0 20px 60px rgba(0,0,0,0.5); aspect-ratio:16/9; }
.video-container video, .video-container iframe { width:100%; height:100%; object-fit:cover; }
.video-placeholder { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(135deg, var(--bg-card), var(--bg-primary)); cursor:pointer; transition:opacity 0.3s; }
.video-placeholder .play-btn { width:80px; height:80px; border-radius:50%; background:var(--gradient-blue); display:flex; align-items:center; justify-content:center; font-size:2rem; transition:transform 0.2s, box-shadow 0.3s; box-shadow:0 0 30px rgba(59,130,246,0.3); }
.video-placeholder:hover .play-btn { transform:scale(1.1); box-shadow:0 0 50px rgba(59,130,246,0.5); }
.video-placeholder p { margin-top:16px; color:var(--text-secondary); font-size:0.9rem; }

/* Stats strip */
.stats-strip { display:flex; gap:48px; margin-top:48px; flex-wrap:wrap; justify-content:center; animation:fadeUp 0.6s ease both 0.75s; opacity:0; }
.stat { text-align:center; }
.stat-number { font-family:var(--font-display); font-size:2.2rem; font-weight:800; background:var(--gradient-hero); background-size:200% 200%; animation:gradient-shift 4s ease infinite; -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.stat-label { font-size:0.82rem; color:var(--text-muted); margin-top:4px; }

/* â•â•â• SECTION COMMON â•â•â• */
.section { padding:100px clamp(16px,5vw,80px); max-width:1200px; margin:0 auto; }
.section-label { display:inline-flex; align-items:center; gap:8px; font-family:var(--font-display); font-size:0.8rem; font-weight:700; text-transform:uppercase; letter-spacing:0.1em; color:var(--accent-blue-light); margin-bottom:16px; }
.section-label .line { width:24px; height:2px; background:var(--accent-blue); border-radius:2px; }
.section-title { font-family:var(--font-display); font-size:clamp(1.8rem,4vw,2.8rem); font-weight:800; line-height:1.15; letter-spacing:-0.02em; margin-bottom:16px; }
.section-desc { font-size:1.05rem; color:var(--text-secondary); line-height:1.7; max-width:600px; margin-bottom:48px; }

/* â•â•â• PROBLEMS â•â•â• */
.problems { background:var(--bg-primary); padding-top:80px; padding-bottom:80px; }
.problems-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:20px; }
.problem-card { padding:28px; border-radius:var(--radius); background:var(--bg-card); border:1px solid rgba(255,255,255,0.05); transition:all 0.3s; }
.problem-card:hover { border-color:rgba(244,63,94,0.3); transform:translateY(-2px); }
.problem-icon { font-size:1.6rem; margin-bottom:14px; }
.problem-title { font-family:var(--font-display); font-weight:700; font-size:1.05rem; margin-bottom:8px; }
.problem-text { font-size:0.88rem; color:var(--text-secondary); line-height:1.6; }

/* â•â•â• FEATURES â•â•â• */
.features-section { position:relative; }
.feature-area { display:grid; grid-template-columns:1fr 1fr; gap:60px; align-items:center; margin-bottom:80px; }
.feature-area.reverse { direction:rtl; }
.feature-area.reverse > * { direction:ltr; }
.feature-tag { display:inline-block; padding:4px 12px; border-radius:100px; font-size:0.75rem; font-weight:700; letter-spacing:0.05em; text-transform:uppercase; margin-bottom:16px; }
.tag-treasury { background:rgba(59,130,246,0.15); color:var(--accent-blue-light); }
.tag-collections { background:rgba(16,185,129,0.15); color:var(--accent-emerald); }
.tag-comms { background:rgba(245,158,11,0.15); color:var(--accent-gold-light); }
.tag-member { background:rgba(139,92,246,0.15); color:#a78bfa; }
.tag-admin { background:rgba(244,63,94,0.15); color:#fb7185; }
.feature-title { font-family:var(--font-display); font-size:clamp(1.4rem,3vw,2rem); font-weight:800; line-height:1.2; letter-spacing:-0.02em; margin-bottom:14px; }
.feature-desc { font-size:0.95rem; color:var(--text-secondary); line-height:1.7; margin-bottom:20px; }
.feature-list { list-style:none; }
.feature-list li { padding:6px 0; font-size:0.9rem; color:var(--text-secondary); display:flex; align-items:center; gap:10px; }
.feature-list li::before { content:'âœ“'; color:var(--accent-emerald); font-weight:700; font-size:0.8rem; }
.feature-video { border-radius:var(--radius); overflow:hidden; background:var(--bg-card); border:1px solid rgba(255,255,255,0.06); box-shadow:var(--shadow-card); aspect-ratio:16/10; position:relative; }
.feature-video .video-placeholder { border-radius:var(--radius); }
.feature-video .play-btn { width:56px; height:56px; font-size:1.3rem; }

/* â•â•â• SOCIAL PROOF â•â•â• */
.proof-section { background:var(--bg-primary); padding:80px clamp(16px,5vw,80px); text-align:center; }
.proof-section .section-title, .proof-section .section-desc { margin-left:auto; margin-right:auto; }
.proof-cards { display:flex; gap:24px; justify-content:center; flex-wrap:wrap; max-width:900px; margin:0 auto; }
.proof-card { flex:1; min-width:260px; max-width:360px; padding:32px; border-radius:var(--radius); background:var(--bg-card); border:1px solid rgba(255,255,255,0.06); text-align:left; transition:all 0.3s; }
.proof-card:hover { border-color:rgba(59,130,246,0.2); transform:translateY(-4px); box-shadow:var(--shadow-glow); }
.proof-quote { font-size:0.95rem; line-height:1.7; color:var(--text-secondary); font-style:italic; margin-bottom:20px; }
.proof-author { display:flex; align-items:center; gap:12px; }
.proof-avatar { width:42px; height:42px; border-radius:50%; background:var(--gradient-blue); display:flex; align-items:center; justify-content:center; font-size:1.1rem; font-weight:700; color:#fff; }
.proof-name { font-weight:700; font-size:0.9rem; }
.proof-role { font-size:0.78rem; color:var(--text-muted); }

/* â•â•â• CTA SECTION â•â•â• */
.cta-section { padding:100px clamp(16px,5vw,80px); text-align:center; }
.cta-box { max-width:800px; margin:0 auto; padding:60px 40px; border-radius:24px; background:linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.1), rgba(245,158,11,0.1)); border:1px solid rgba(255,255,255,0.08); position:relative; overflow:hidden; }
.cta-box::before { content:''; position:absolute; top:-50%; right:-30%; width:400px; height:400px; background:radial-gradient(circle, rgba(245,158,11,0.08), transparent 70%); }
.cta-title { font-family:var(--font-display); font-size:clamp(1.6rem,4vw,2.4rem); font-weight:800; margin-bottom:16px; position:relative; }
.cta-desc { color:var(--text-secondary); font-size:1.05rem; max-width:500px; margin:0 auto 32px; line-height:1.7; position:relative; }

/* â•â•â• FOOTER â•â•â• */
.footer { padding:40px clamp(16px,5vw,80px) calc(40px + var(--cta-bar-h)); border-top:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:16px; max-width:1200px; margin:0 auto; }
.footer-left { font-size:0.85rem; color:var(--text-muted); }
.footer-links { display:flex; gap:24px; }
.footer-links a { font-size:0.85rem; color:var(--text-muted); transition:color 0.2s; }
.footer-links a:hover { color:var(--text-primary); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIXED CTA BAR â€” "La TentaciÃ³n"
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cta-bar {
  position:fixed; bottom:0; left:0; right:0; z-index:200;
  height:var(--cta-bar-h);
  background:linear-gradient(135deg, rgba(10,22,40,0.97), rgba(17,29,51,0.97));
  backdrop-filter:blur(24px) saturate(1.5);
  border-top:1px solid rgba(245,158,11,0.25);
  display:flex; align-items:center;
  padding:0 clamp(12px,3vw,32px);
  gap:clamp(12px,2vw,20px);
  box-shadow:0 -8px 40px rgba(0,0,0,0.4);
}

/* Photo */
.cta-bar-photo {
  flex-shrink:0; width:64px; height:64px;
  border-radius:50%; overflow:hidden;
  border:2.5px solid var(--accent-gold);
  animation:glow-pulse 3s ease-in-out infinite;
  cursor:pointer;
}
.cta-bar-photo img { width:100%; height:100%; object-fit:cover; object-position:top center; }

/* Text */
.cta-bar-text { flex:1; min-width:0; }
.cta-bar-text h4 {
  font-family:var(--font-display); font-size:0.95rem; font-weight:700;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.cta-bar-text h4 .name-gold { color:var(--accent-gold-light); }
.cta-bar-text p {
  font-size:0.78rem; color:var(--accent-emerald);
  display:flex; align-items:center; gap:5px;
}
.cta-bar-text p::before { content:''; width:7px; height:7px; border-radius:50%; background:var(--accent-emerald); box-shadow:0 0 6px var(--accent-emerald); animation:pulse-ring 2s infinite; }

/* Buttons */
.cta-bar-actions { display:flex; gap:8px; flex-shrink:0; }
.btn-chat-bar {
  padding:10px 20px; border-radius:100px;
  background:var(--gradient-gold); color:#000;
  font-weight:800; font-size:0.85rem;
  display:flex; align-items:center; gap:6px;
  transition:transform 0.2s, box-shadow 0.2s;
  white-space:nowrap;
  animation:nudge 4s ease-in-out infinite 5s;
}
.btn-chat-bar:hover { transform:scale(1.05); box-shadow:0 4px 24px rgba(245,158,11,0.4); }
.btn-install-bar {
  padding:10px 16px; border-radius:100px;
  background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15);
  color:var(--text-primary); font-weight:600; font-size:0.82rem;
  display:flex; align-items:center; gap:6px;
  transition:all 0.2s; white-space:nowrap;
}
.btn-install-bar:hover { background:rgba(255,255,255,0.12); border-color:rgba(255,255,255,0.25); }

/* Notification badge on CTA bar */
.cta-bar-badge {
  position:absolute; top:-8px; right:clamp(12px,3vw,32px);
  padding:4px 12px; border-radius:100px;
  background:var(--accent-rose); color:#fff;
  font-size:0.72rem; font-weight:700;
  display:none; animation:bounceIn 0.5s ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FULLSCREEN CHAT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chat-overlay {
  position:fixed; inset:0; z-index:500;
  display:none; flex-direction:column;
  background:var(--bg-deep);
  animation:slideUp 0.4s cubic-bezier(0.16,1,0.3,1);
}
.chat-overlay.open { display:flex; }

/* Chat header */
.chat-head {
  padding:16px 20px;
  background:linear-gradient(135deg, rgba(59,130,246,0.12), rgba(139,92,246,0.08));
  border-bottom:1px solid rgba(255,255,255,0.06);
  display:flex; align-items:center; gap:14px;
  flex-shrink:0;
}
.chat-head-photo {
  width:48px; height:48px; border-radius:50%; overflow:hidden;
  border:2px solid var(--accent-blue);
  flex-shrink:0;
}
.chat-head-photo img { width:100%; height:100%; object-fit:cover; }
.chat-head-info { flex:1; }
.chat-head-info h3 { font-family:var(--font-display); font-size:1.05rem; font-weight:700; }
.chat-head-info p { font-size:0.8rem; color:var(--accent-emerald); display:flex; align-items:center; gap:5px; }
.chat-head-info p::before { content:''; width:7px; height:7px; border-radius:50%; background:var(--accent-emerald); box-shadow:0 0 6px var(--accent-emerald); }
.chat-close-btn {
  width:40px; height:40px; border-radius:50%;
  background:rgba(255,255,255,0.06);
  display:flex; align-items:center; justify-content:center;
  color:var(--text-secondary); font-size:1.3rem;
  transition:all 0.2s;
}
.chat-close-btn:hover { background:rgba(255,255,255,0.12); color:var(--text-primary); }

/* Chat messages area */
.chat-body {
  flex:1; overflow-y:auto; padding:20px;
  display:flex; flex-direction:column; gap:10px;
  background:
    radial-gradient(circle at 20% 80%, rgba(59,130,246,0.04) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(245,158,11,0.03) 0%, transparent 50%),
    var(--bg-deep);
}

/* Messages */
.chat-msg {
  max-width:80%; padding:14px 18px;
  font-size:0.92rem; line-height:1.6;
  animation:msgAppear 0.4s cubic-bezier(0.16,1,0.3,1) both;
  position:relative;
}
.chat-msg.them {
  align-self:flex-start;
  background:linear-gradient(135deg, rgba(59,130,246,0.12), rgba(99,102,241,0.08));
  border:1px solid rgba(59,130,246,0.15);
  border-radius:4px 20px 20px 20px;
  color:var(--text-primary);
}
.chat-msg.me {
  align-self:flex-end;
  background:linear-gradient(135deg, var(--accent-blue), #6366f1);
  border-radius:20px 4px 20px 20px;
  color:#fff;
}
.chat-msg .time { font-size:0.68rem; opacity:0.5; margin-top:6px; text-align:right; }
.chat-msg.them .avatar-mini {
  position:absolute; top:-4px; left:-4px;
  width:28px; height:28px; border-radius:50%;
  overflow:hidden; border:2px solid var(--bg-deep);
}
.chat-msg.them .avatar-mini img { width:100%; height:100%; object-fit:cover; }

/* Typing indicator */
.typing-indicator {
  align-self:flex-start; padding:14px 20px;
  background:rgba(59,130,246,0.08);
  border:1px solid rgba(59,130,246,0.1);
  border-radius:4px 20px 20px 20px;
  display:none; gap:5px; align-items:center;
}
.typing-indicator.show { display:flex; }
.typing-dot {
  width:8px; height:8px; border-radius:50%;
  background:var(--accent-blue-light);
}
.typing-dot:nth-child(1) { animation:typing 1.2s infinite 0s; }
.typing-dot:nth-child(2) { animation:typing 1.2s infinite 0.2s; }
.typing-dot:nth-child(3) { animation:typing 1.2s infinite 0.4s; }

/* Chat input */
.chat-footer {
  padding:12px 16px;
  background:var(--bg-primary);
  border-top:1px solid rgba(255,255,255,0.06);
  display:flex; gap:10px; align-items:center;
  flex-shrink:0;
}
.chat-input {
  flex:1; padding:14px 18px;
  border-radius:100px; border:1px solid rgba(255,255,255,0.1);
  background:var(--bg-card); color:var(--text-primary);
  font-size:0.95rem; font-family:var(--font-body);
  outline:none; transition:border-color 0.2s;
}
.chat-input:focus { border-color:var(--accent-blue); box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.chat-input::placeholder { color:var(--text-muted); }
.chat-send {
  width:48px; height:48px; border-radius:50%;
  background:var(--gradient-blue);
  display:flex; align-items:center; justify-content:center;
  color:#fff; font-size:1.2rem;
  transition:transform 0.2s, box-shadow 0.2s;
  flex-shrink:0;
}
.chat-send:hover { transform:scale(1.08); box-shadow:0 4px 16px rgba(59,130,246,0.3); }

/* â•â•â• RESPONSIVE â•â•â• */
@media (max-width:900px) {
  .feature-area { grid-template-columns:1fr; gap:32px; }
  .feature-area.reverse { direction:ltr; }
  .nav-links { display:none; }
  .nav-hamburger { display:block; }
  .stats-strip { gap:24px; }
  .stat-number { font-size:1.6rem; }
}
@media (max-width:600px) {
  .hero-h1 { font-size:2rem; }
  .hero-actions { flex-direction:column; width:100%; }
  .hero-actions .btn-primary, .hero-actions .btn-secondary { width:100%; justify-content:center; }
  .problems-grid { grid-template-columns:1fr; }
  .proof-cards { flex-direction:column; align-items:center; }
  .cta-bar { gap:8px; padding:0 10px; }
  .cta-bar-photo { width:50px; height:50px; }
  .cta-bar-text h4 { font-size:0.82rem; }
  .btn-install-bar span.lbl { display:none; }
  .chat-msg { max-width:88%; }
}
</style>
</head>
<body>

<!-- â•â•â• NAVBAR â•â•â• -->
<nav class="nav" id="nav">
  <a href="#" class="nav-logo">ğŸ›ï¸ <span>ColegiosPro</span></a>
  <div class="nav-links">
    <a href="#soluciones">Soluciones</a>
    <a href="#demos">Demos</a>
    <a href="#resultados">Resultados</a>
    <a href="#contacto">Contacto</a>
  </div>
  <button class="nav-hamburger" onclick="toggleMobileMenu()">â˜°</button>
</nav>

<!-- â•â•â• HERO â•â•â• -->
<section class="hero" id="inicio">
  <div class="hero-bg"><div class="hero-grid"></div></div>
  <div class="hero-content">
    <div class="hero-badge"><span class="dot"></span> Plataforma lÃ­der en gestiÃ³n colegial</div>
    <h1 class="hero-h1">Modernice su<br><span class="highlight">Colegio Profesional</span></h1>
    <p class="hero-sub">FacturaciÃ³n electrÃ³nica, cobranzas, comunicaciones y gestiÃ³n integral. Todo en una plataforma diseÃ±ada para Colegios Profesionales del PerÃº.</p>
    <div class="hero-actions">
      <a href="#demos" class="btn-primary">â–¶ Ver demostraciÃ³n</a>
      <button class="btn-secondary" onclick="openChat()">ğŸ’¬ Conversemos</button>
    </div>
    <div class="hero-video-wrap">
      <div class="video-container" id="heroVideo">
        <div class="video-placeholder" onclick="playHeroVideo()">
          <div class="play-btn">â–¶</div>
          <p>Conozca ColegiosPro en 90 segundos</p>
        </div>
        <video src="" poster="" preload="none" controls style="display:none" id="heroVideoEl"></video>
      </div>
    </div>
    <div class="stats-strip">
      <div class="stat"><div class="stat-number">500+</div><div class="stat-label">Colegiados activos</div></div>
      <div class="stat"><div class="stat-number">100%</div><div class="stat-label">Digital y en la nube</div></div>
      <div class="stat"><div class="stat-number">24/7</div><div class="stat-label">Disponible siempre</div></div>
      <div class="stat"><div class="stat-number">SUNAT</div><div class="stat-label">FacturaciÃ³n electrÃ³nica</div></div>
    </div>
  </div>
</section>

<!-- â•â•â• PROBLEMAS â•â•â• -->
<section class="section problems" id="problemas">
  <div class="section-label reveal"><span class="line"></span> El problema</div>
  <h2 class="section-title reveal">Â¿Le suena familiar?</h2>
  <p class="section-desc reveal">Los desafÃ­os que enfrentan la mayorÃ­a de Colegios Profesionales hoy.</p>
  <div class="problems-grid">
    <div class="problem-card reveal reveal-delay-1"><div class="problem-icon">ğŸ“‹</div><h3 class="problem-title">Morosidad alta</h3><p class="problem-text">MÃ¡s del 60% de colegiados no pagan a tiempo. No tienen cÃ³mo ver su deuda ni pagar fÃ¡cilmente.</p></div>
    <div class="problem-card reveal reveal-delay-2"><div class="problem-icon">ğŸ§¾</div><h3 class="problem-title">Sin facturaciÃ³n electrÃ³nica</h3><p class="problem-text">SUNAT exige comprobantes electrÃ³nicos. Muchos colegios aÃºn emiten boletas a mano o en Excel.</p></div>
    <div class="problem-card reveal reveal-delay-3"><div class="problem-icon">ğŸ’»</div><h3 class="problem-title">Sistemas obsoletos</h3><p class="problem-text">Software antiguo, sin versiÃ³n web, sin app mÃ³vil, sin acceso remoto para directivos.</p></div>
    <div class="problem-card reveal reveal-delay-4"><div class="problem-icon">ğŸ“</div><h3 class="problem-title">ComunicaciÃ³n nula</h3><p class="problem-text">El colegiado no se entera de nada. Cero canales digitales para avisos, asambleas ni trÃ¡mites.</p></div>
  </div>
</section>

<!-- â•â•â• SOLUCIONES / DEMOS â•â•â• -->
<section class="section features-section" id="soluciones">
  <div class="section-label reveal"><span class="line"></span> Soluciones</div>
  <h2 class="section-title reveal">Todo lo que su colegio necesita</h2>
  <p class="section-desc reveal">Cada mÃ³dulo diseÃ±ado para resolver problemas reales. Vea las demos en video.</p>

  <div class="feature-area reveal" id="demos">
    <div class="feature-info"><span class="feature-tag tag-treasury">TesorerÃ­a & Caja</span><h3 class="feature-title">Cobros y facturaciÃ³n<br>en un solo lugar</h3><p class="feature-desc">Punto de venta inteligente para la cajera. Cobra cuotas, emite boletas y facturas electrÃ³nicas al instante, con validaciÃ³n SUNAT en tiempo real.</p><ul class="feature-list"><li>Boletas y facturas electrÃ³nicas SUNAT</li><li>Notas de crÃ©dito y dÃ©bito</li><li>Yape, Plin, transferencia, efectivo</li><li>Historial y reimpresiÃ³n de comprobantes</li><li>Cierre de caja diario</li></ul></div>
    <div class="feature-video"><div class="video-placeholder" onclick="playDemo(this)"><div class="play-btn">â–¶</div><p>Demo: Caja y FacturaciÃ³n</p></div><video src="" preload="none" controls style="display:none"></video></div>
  </div>

  <div class="feature-area reverse reveal">
    <div class="feature-info"><span class="feature-tag tag-collections">Cobranzas & Finanzas</span><h3 class="feature-title">Reduzca la morosidad<br>automÃ¡ticamente</h3><p class="feature-desc">GeneraciÃ³n automÃ¡tica de deudas, fraccionamiento, alertas de vencimiento y pasarela de pagos online.</p><ul class="feature-list"><li>GeneraciÃ³n masiva de cuotas mensuales</li><li>Pasarela de pagos online (Yape, tarjeta)</li><li>Fraccionamiento de deudas</li><li>Cambio automÃ¡tico de habilidad al pagar</li><li>Reportes de morosidad por periodo</li></ul></div>
    <div class="feature-video"><div class="video-placeholder" onclick="playDemo(this)"><div class="play-btn">â–¶</div><p>Demo: Cobranzas Online</p></div><video src="" preload="none" controls style="display:none"></video></div>
  </div>

  <div class="feature-area reveal">
    <div class="feature-info"><span class="feature-tag tag-comms">Comunicaciones</span><h3 class="feature-title">Conecte con sus<br>colegiados al instante</h3><p class="feature-desc">Chat en tiempo real, notificaciones push, mesa de partes virtual y buzÃ³n de comunicaciones.</p><ul class="feature-list"><li>Chat en tiempo real (WebSocket)</li><li>Notificaciones push en celular</li><li>Mesa de partes virtual</li><li>Avisos de asambleas y eventos</li><li>BuzÃ³n de comunicaciones</li></ul></div>
    <div class="feature-video"><div class="video-placeholder" onclick="playDemo(this)"><div class="play-btn">â–¶</div><p>Demo: Comunicaciones</p></div><video src="" preload="none" controls style="display:none"></video></div>
  </div>

  <div class="feature-area reverse reveal">
    <div class="feature-info"><span class="feature-tag tag-member">Portal del Colegiado</span><h3 class="feature-title">Experiencia digital<br>para cada colegiado</h3><p class="feature-desc">Dashboard personal con estado de habilidad, deudas, pagos, certificados digitales y sitio web profesional.</p><ul class="feature-list"><li>Dashboard con estado de habilidad</li><li>Ver y pagar deudas pendientes</li><li>Certificados digitales con QR</li><li>Sitio web personal del colegiado</li><li>Alertas tributarias y recordatorios</li></ul></div>
    <div class="feature-video"><div class="video-placeholder" onclick="playDemo(this)"><div class="play-btn">â–¶</div><p>Demo: Portal del Colegiado</p></div><video src="" preload="none" controls style="display:none"></video></div>
  </div>

  <div class="feature-area reveal">
    <div class="feature-info"><span class="feature-tag tag-admin">AdministraciÃ³n & Directivos</span><h3 class="feature-title">Control total<br>desde cualquier lugar</h3><p class="feature-desc">Panel para directivos con mÃ©tricas en tiempo real, aprobaciones, reportes y control administrativo.</p><ul class="feature-list"><li>Dashboard ejecutivo con mÃ©tricas clave</li><li>Reportes de recaudaciÃ³n exportables</li><li>GestiÃ³n de usuarios y permisos</li><li>Capacitaciones y eventos</li><li>Votaciones electrÃ³nicas</li></ul></div>
    <div class="feature-video"><div class="video-placeholder" onclick="playDemo(this)"><div class="play-btn">â–¶</div><p>Demo: Panel de Directivos</p></div><video src="" preload="none" controls style="display:none"></video></div>
  </div>
</section>

<!-- â•â•â• SOCIAL PROOF â•â•â• -->
<section class="proof-section" id="resultados">
  <div class="section-label reveal" style="justify-content:center"><span class="line"></span> Resultados</div>
  <h2 class="section-title reveal">Ya funciona en producciÃ³n</h2>
  <p class="section-desc reveal" style="margin-left:auto;margin-right:auto;">El Colegio de Contadores PÃºblicos de Loreto ya usa ColegiosPro con mÃ¡s de 500 colegiados activos.</p>
  <div class="proof-cards">
    <div class="proof-card reveal reveal-delay-1"><p class="proof-quote">"Antes cobrÃ¡bamos con recibos a mano. Ahora la cajera emite boletas electrÃ³nicas en segundos y SUNAT las valida al instante."</p><div class="proof-author"><div class="proof-avatar">C</div><div><div class="proof-name">CCPL Loreto</div><div class="proof-role">Caja / TesorerÃ­a</div></div></div></div>
    <div class="proof-card reveal reveal-delay-2"><p class="proof-quote">"Los colegiados pueden ver su deuda y pagar desde el celular, a cualquier hora. La morosidad empezÃ³ a bajar inmediatamente."</p><div class="proof-author"><div class="proof-avatar">C</div><div><div class="proof-name">CCPL Loreto</div><div class="proof-role">Cobranzas</div></div></div></div>
  </div>
</section>

<!-- â•â•â• CTA â•â•â• -->
<section class="cta-section" id="contacto">
  <div class="cta-box reveal">
    <h2 class="cta-title">Â¿Listo para modernizar<br>su Colegio Profesional?</h2>
    <p class="cta-desc">Conversemos sobre cÃ³mo ColegiosPro puede transformar la gestiÃ³n de su instituciÃ³n. Sin compromiso.</p>
    <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap;position:relative">
      <button class="btn-primary" onclick="openChat()">ğŸ’¬ EscrÃ­bame ahora</button>
      <a href="mailto:duilio@perusistemas.com" class="btn-secondary">ğŸ“§ Enviar correo</a>
    </div>
  </div>
</section>

<footer class="footer">
  <div class="footer-left">Â© 2026 ColegiosPro â€” PerÃº Sistemas Pro E.I.R.L.</div>
  <div class="footer-links"><a href="#">TÃ©rminos</a><a href="#">Privacidad</a><a href="https://duilio.store" target="_blank">duilio.store</a></div>
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIXED CTA BAR â€” Always visible
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="cta-bar" id="ctaBar">
  <span class="cta-bar-badge" id="ctaBadge">Nuevo mensaje</span>
  <div class="cta-bar-photo" onclick="openChat()">
    <!-- REEMPLAZAR: src con ruta a duilio-cta.jpg en static -->
    <img src="/static/img/duilio-cta.jpg" alt="Duilio" loading="eager">
  </div>
  <div class="cta-bar-text" onclick="openChat()">
    <h4>Soy <span class="name-gold">Duilio</span> â€” Hablemos</h4>
    <p>En lÃ­nea ahora</p>
  </div>
  <div class="cta-bar-actions">
    <button class="btn-chat-bar" onclick="openChat()">ğŸ’¬ Chatear</button>
    <button class="btn-install-bar" id="btnInstallBar" style="display:none" onclick="installApp()">ğŸ“² <span class="lbl">Instalar</span></button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FULLSCREEN CHAT OVERLAY
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="chat-overlay" id="chatOverlay">
  <div class="chat-head">
    <div class="chat-head-photo">
      <img src="/static/img/duilio-chat.jpg" alt="Duilio">
    </div>
    <div class="chat-head-info">
      <h3>Duilio â€” PerÃº Sistemas</h3>
      <p>En lÃ­nea</p>
    </div>
    <button class="chat-close-btn" onclick="closeChat()">âœ•</button>
  </div>
  <div class="chat-body" id="chatBody">
    <div class="typing-indicator" id="typingIndicator">
      <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
    </div>
  </div>
  <div class="chat-footer">
    <input class="chat-input" id="chatInput" type="text" placeholder="EscrÃ­bame..." onkeydown="if(event.key==='Enter')sendMessage()">
    <button class="chat-send" onclick="sendMessage()">â¤</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   URL TRACKING â€” Identify visitors
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Usage: /demo?ref=CIP-LORETO&nombre=Ing.+Garcia&cargo=Decano
*/
const params = new URLSearchParams(window.location.search);
const VISITOR = {
  ref:    params.get('ref') || 'directo',
  nombre: params.get('nombre') || '',
  cargo:  params.get('cargo') || '',
  foto:   params.get('foto') || '',  // URL to visitor's photo (optional)
  id:     params.get('ref') || 'anon-' + Date.now()
};

/* â•â•â• SCROLL ANIMATIONS â•â•â• */
const observer = new IntersectionObserver((entries) => {
  entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold:0.1, rootMargin:'0px 0px -40px 0px' });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
window.addEventListener('scroll', () => {
  document.getElementById('nav').classList.toggle('scrolled', window.scrollY > 50);
});

/* â•â•â• VIDEO PLAYERS â•â•â• */

/* â•â•â• VIDEO PLAYERS WITH TRACKING â•â•â• */
function trackVideo(videoName, action) {
  fetch('/api/track', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'video_' + action,  // video_play, video_pause, video_ended, video_25, video_50, video_75
      ref: VISITOR.ref,
      nombre: VISITOR.nombre,
      cargo: VISITOR.cargo,
      referrer: videoName,         // Usamos referrer para guardar el nombre del video
      timestamp: new Date().toISOString()
    })
  }).catch(() => {});
}

function setupVideoTracking(video, videoName) {
  // Play
  video.addEventListener('play', () => trackVideo(videoName, 'play'));
  // Pause
  video.addEventListener('pause', () => {
    if (!video.ended) trackVideo(videoName, 'pause');
  });
  // Ended (vio completo)
  video.addEventListener('ended', () => trackVideo(videoName, 'ended'));
  // Progress: 25%, 50%, 75%
  let tracked = { 25: false, 50: false, 75: false };
  video.addEventListener('timeupdate', () => {
    if (video.duration > 0) {
      const pct = (video.currentTime / video.duration) * 100;
      if (pct >= 25 && !tracked[25]) { tracked[25] = true; trackVideo(videoName, '25'); }
      if (pct >= 50 && !tracked[50]) { tracked[50] = true; trackVideo(videoName, '50'); }
      if (pct >= 75 && !tracked[75]) { tracked[75] = true; trackVideo(videoName, '75'); }
    }
  });
}


function playHeroVideo() {
  const v = document.getElementById('heroVideoEl');
  const p = document.querySelector('#heroVideo .video-placeholder');
  if (v.src && v.src !== location.href) {
    p.style.display = 'none';
    v.style.display = 'block';
    v.play();
    setupVideoTracking(v, 'presentacion');
  } else {
    alert('Video de presentaciÃ³n prÃ³ximamente.\nReemplace el src del video en el HTML.');
  }
}

function playDemo(ph) {
  const container = ph.parentElement;
  const v = container.querySelector('video');
  // Detectar nombre del demo por el texto del placeholder
  const label = ph.querySelector('p')?.textContent || 'demo';
  const videoName = label.replace('Demo: ', '').toLowerCase().replace(/\s+/g, '-');

  if (v.src && v.src !== location.href) {
    ph.style.display = 'none';
    v.style.display = 'block';
    v.play();
    setupVideoTracking(v, videoName);
  } else {
    // Aunque no hay video, registrar que hizo clic
    trackVideo(videoName, 'click_placeholder');
    alert('Video demo prÃ³ximamente.\nReemplace el src del video en el HTML.');
  }
}

/* â•â•â• CHAT â€” Fullscreen â•â•â• */
let chatOpen = false;
let chatInitialized = false;
let ws = null;

function openChat() {
  chatOpen = true;
  document.getElementById('chatOverlay').classList.add('open');
  document.getElementById('ctaBadge').style.display = 'none';
  document.body.style.overflow = 'hidden';
  if (!chatInitialized) { initChat(); chatInitialized = true; }
  setTimeout(() => document.getElementById('chatInput').focus(), 400);
}

function closeChat() {
  chatOpen = false;
  document.getElementById('chatOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function initChat() {
  // Personalized greeting based on URL params
  const nombre = VISITOR.nombre;
  const saludo = nombre
    ? `Â¡Hola ${nombre}! ğŸ‘‹ Soy Duilio, fundador de PerÃº Sistemas. Gracias por tomarse un momento para conocer ColegiosPro.`
    : 'Â¡Hola! ğŸ‘‹ Soy Duilio, fundador de PerÃº Sistemas. Gracias por su interÃ©s en ColegiosPro.';

  showTyping();
  setTimeout(() => {
    hideTyping();
    addMessage('them', saludo);
    showTyping();
    setTimeout(() => {
      hideTyping();
      const msg2 = nombre
        ? 'Â¿CÃ³mo puedo ayudarle? Puedo mostrarle cÃ³mo funciona la plataforma en su tipo de colegio.'
        : 'Â¿En quÃ© colegio profesional trabaja? Me encantarÃ­a mostrarle cÃ³mo funciona la plataforma.';
      addMessage('them', msg2);
    }, 2000);
  }, 1500);

  connectWebSocket();

  // Log visit
  logVisit('chat_opened');
}

function showTyping() { document.getElementById('typingIndicator').classList.add('show'); scrollChat(); }
function hideTyping() { document.getElementById('typingIndicator').classList.remove('show'); }

function connectWebSocket() {
  const wsUrl = `wss://colegiospro.org.pe/ws/chat?ref=${VISITOR.ref}&nombre=${encodeURIComponent(VISITOR.nombre)}&cargo=${encodeURIComponent(VISITOR.cargo)}`;
  try {
    ws = new WebSocket(wsUrl);
    ws.onopen = () => console.log('WS connected');
    ws.onmessage = (e) => {
      try {
        const data = JSON.parse(e.data);
        if (data.type === 'message') {
          hideTyping();
          addMessage('them', data.text);
          if (!chatOpen) {
            document.getElementById('ctaBadge').style.display = 'block';
            document.getElementById('ctaBadge').textContent = 'Nuevo mensaje';
          }
        } else if (data.type === 'typing') {
          showTyping();
        }
      } catch(err) { addMessage('them', e.data); }
    };
    ws.onclose = () => { ws = null; };
    ws.onerror = () => { ws = null; };
  } catch(e) { ws = null; }
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  addMessage('me', text);
  input.value = '';

  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({
      type:'message', text,
      from:'visitor',
      ref: VISITOR.ref,
      nombre: VISITOR.nombre,
      cargo: VISITOR.cargo,
      timestamp: new Date().toISOString()
    }));
  } else {
    showTyping();
    setTimeout(() => {
      hideTyping();
      addMessage('them', 'Gracias por su mensaje. Le responderÃ© en breve. TambiÃ©n puede escribirme a duilio@perusistemas.com');
    }, 1500);
  }
}

function addMessage(who, text) {
  const body = document.getElementById('chatBody');
  const indicator = document.getElementById('typingIndicator');
  const div = document.createElement('div');
  div.className = `chat-msg ${who}`;
  const now = new Date();
  const time = now.toLocaleTimeString('es-PE', {hour:'2-digit',minute:'2-digit'});

  let avatarHtml = '';
  if (who === 'them') {
    avatarHtml = `<div class="avatar-mini"><img src="/static/img/duilio-chat.jpg" alt="D"></div>`;
  }

  let visitorAvatar = '';
  if (who === 'me' && VISITOR.foto) {
    // Future: show visitor's photo
  }

  div.innerHTML = `${avatarHtml}${text}<div class="time">${time}</div>`;
  body.insertBefore(div, indicator);
  scrollChat();
}

function scrollChat() {
  const body = document.getElementById('chatBody');
  setTimeout(() => { body.scrollTop = body.scrollHeight; }, 50);
}

/* â•â•â• PWA INSTALL â•â•â• */
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('btnInstallBar').style.display = 'flex';
});

function installApp() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((r) => {
      if (r.outcome === 'accepted') logVisit('pwa_installed');
      deferredPrompt = null;
      document.getElementById('btnInstallBar').style.display = 'none';
    });
  }
}

/* â•â•â• VISIT LOGGING â•â•â• */
function logVisit(action) {
  fetch('/api/track', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      action,
      ref: VISITOR.ref,
      nombre: VISITOR.nombre,
      cargo: VISITOR.cargo,
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent,
      referrer: document.referrer
    })
  }).catch(() => {});
}

// Log page view on load
logVisit('page_view');

// Show badge hint after 12 seconds if chat not opened
setTimeout(() => {
  if (!chatOpen) {
    document.getElementById('ctaBadge').style.display = 'block';
    document.getElementById('ctaBadge').textContent = VISITOR.nombre ? `Hola ${VISITOR.nombre.split(' ')[0]}` : 'Â¿Hablamos?';
  }
}, 12000);

/* â•â•â• SERVICE WORKER â•â•â• */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').catch(() => {});
}

/* â•â•â• MOBILE MENU â•â•â• */
function toggleMobileMenu() {
  const links = document.querySelector('.nav-links');
  const isOpen = links.style.display === 'flex';
  Object.assign(links.style, {
    display: isOpen ? 'none' : 'flex',
    position:'absolute', top:'var(--nav-h)', left:'0', right:'0',
    flexDirection:'column', padding:'20px',
    background:'rgba(6,13,27,0.97)',
    borderBottom:'1px solid rgba(255,255,255,0.05)', gap:'16px'
  });
}
</script>
</body>
</html>